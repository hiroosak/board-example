/! board 22-03-2014 */
"use strict";angular.module("boardApp.controllers",[]).controller("HomeCtrl",["$scope","helpers",function(a,b){a.isLogin=b.isLogin()}]).controller("BoardShowCtrl",["$scope","$routeParams","Board","helpers",function(a,b,c,d){c.get({boardId:b.boardId},function(b){a.board=b.board,a.threads=b.threads,a.isLogin=d.isLogin()})}]).controller("ThreadCreateCtrl",["$scope","$routeParams",function(){}]).controller("ResponseCreateCtrl",["$scope","$routeParams",function(){}]).controller("ThreadShowCtrl",["$rootScope","$location","$scope","$http","$routeParams","growl","helpers","Thread","Response",function(a,b,c,d,e,f,g,h,i){c.isLogin=g.isLogin();h.get({threadId:e.threadId},function(a){c.thread=a.thread,c.responses=a.responses});c.destroyThread=function(a){h.destroy({threadId:a._id},{},function(){f.addSuccessMessage("スレッドを削除しました",{ttl:3e3}),b.path("/boards/"+a.board._id).replace()},function(){f.addErrorMessage("スレッド削除に失敗しました",{ttl:3e3})})},c.destroyResponse=function(a){i.destroy({responseId:a._id},{},function(){c.responses=_.reject(c.responses,function(b){return b._id===a._id}),f.addSuccessMessage("コメントを削除しました",{ttl:3e3})},function(){f.addErrorMessage("コメント削除に失敗しました",{ttl:3e3})})},c.user=a.user,c.$on("profileResolved",function(a,b){c.user=b})}]),angular.module("boardApp.partials",["ngRoute","angular-growl"]).controller("HeaderNavRightCtrl",["$rootScope","$scope","$window","Authenticate","localStorageService","helpers","$resource",function(a,b,c,d,e,f,g){d.post(function(c){e.add("tkn",c.token),b.isLogin=!0;var d=g("/api/1/users/:userId",{userId:"@id"},{me:{method:"GET",params:{userId:"me"},headers:f.authHeader()}});d.me(function(c){b.profile=c.profile,a.user=c,a.$broadcast("profileResolved",c)})},function(){b.isLogin=!1,e.add("tkn",null)})}]).controller("SideMenuCtrl",["$scope","Category",function(a,b){b.query(function(b){a.categories=b})}]).controller("CreateThreadFormCtrl",["$scope","$routeParams","$http","$location","growl","Board","Thread",function(a,b,c,d,e,f,g){f.get({boardId:b.boardId},function(b){a.board=b.board}),a.submit=function(a){a.board=b.boardId,g.save(a,function(){e.addSuccessMessage("スレッドを投稿しました",{ttl:3e3}),d.path("/boards/"+a.board).replace()},function(){e.addErrorMessage("スレッド投稿失敗しました",{ttl:3e3})})}}]).controller("CreateResponseFormCtrl",["$scope","$routeParams","$http","$location","growl","Thread","Response",function(a,b,c,d,e,f,g){f.get({threadId:b.threadId},function(b){a.thread=b.thread}),a.submit=function(a){a.thread=b.threadId,g.save(a,function(){e.addSuccessMessage("コメントを投稿しました",{ttl:3e3}),d.path("/threads/"+a.thread).replace()},function(){e.addErrorMessage("コメント投稿失敗しました",{ttl:3e3})})}}]);var helpers=angular.module("boardApp.helpers",["LocalStorageModule"]);helpers.factory("_",function(){return window._?window._:null}),helpers.factory("helpers",["_","localStorageService",function(a,b){return{authHeader:function(){return{authorization:"Bearer "+b.get("tkn")}},isLogin:function(){return!a.isNull(b.get("tkn"))}}}]);var services=angular.module("boardApp.services",["ngResource","boardApp.helpers"]).factory("Authenticate",["$resource",function(a){return a("/api/1/authenticate",{},{post:{method:"POST"},verify:{method:"POST",url:"/api/1/authenticate/verify"}})}]).factory("User",["$resource","helpers",function(a,b){return a("/api/1/users/:userId",{userId:"@id"},{me:{method:"GET",params:{userId:"me"},headers:b.authHeader()}})}]).factory("Category",["$resource",function(a){return a("/api/1/categories")}]).factory("Board",["$resource",function(a){return a("/api/1/boards/:boardId",{boardId:"@id"})}]).factory("Thread",["$resource","helpers",function(a,b){return a("/api/1/threads/:threadId/:action",{threadId:"@_id"},{save:{method:"POST",headers:b.authHeader()},destroy:{method:"POST",headers:b.authHeader(),params:{action:"destroy"}}})}]).factory("Response",["$resource","helpers",function(a,b){return a("/api/1/responses/:responseId/:action",{responseId:"@id"},{save:{method:"POST",headers:b.authHeader()},destroy:{method:"POST",headers:b.authHeader(),params:{action:"destroy"}}})}]),boardApp=angular.module("boardApp",["ngRoute","ngCookies","LocalStorageModule","ui.bootstrap","angular-growl","ngAnimate","boardApp.helpers","boardApp.services","boardApp.controllers","boardApp.partials"]);boardApp.config(["$routeProvider",function(a){var b={templateUrl:"/partials/home.html",controller:"HomeCtrl"};a.when("/",b).when("",b).when("/boards/:boardId",{templateUrl:"/partials/board.html",controller:"BoardShowCtrl"}).when("/threads/:threadId",{templateUrl:"/partials/thread.html",controller:"ThreadShowCtrl"}).when("/boards/:boardId/threads/create",{templateUrl:"/partials/thread_create.html",controller:"ThreadCreateCtrl"}).when("/threads/:threadId/responses/create",{templateUrl:"/partials/response_create.html",controller:"ResponseCreateCtrl"}).otherwise({redirectTo:"/"})}]);